confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
confu (p1, Y1$y)
confu (Y1$probs, Y1$y)
pROC::auc( Y2$y,  (Y2$probs) )
confu (p2, Y2$y)
confu (Y2$probs, Y2$y)
pROC::auc( Y3$y,  (Y3$probs) )
confu (p3, Y3$y)
pROC::auc( Y4$y,  (Y4$probs) )
confu (p4, Y4$y)
pos_analysis = function(){
V1 = Y1[Y1$y==1,]
V2= Y2[Y2$y==1,]
V3= Y3[Y3$y==1,]
V4= Y4[Y4$y==1,]
900 + 368 + 208 + 145
796 + 390+194+131
hist(V1$exams)
cor(V1$exams, V1$probs)
cor(V2$exams, V2$probs)
cor(V3$exams, V3$probs)
cor(V4$exams, V4$probs)
hist(V1$exams[V1$exams<1000])
hist(V2$exams)
hist(V2$exams)
hist(V4$exams)
summary(V1$exams)
summary(V2$exams)
}
message(normalizePath("~"))
rm(list = ls())
library(fst)
library(dplyr)
library(stringr)
library(plyr)
library(data.table)
library(caret)
library("Metrics")
setwd('G:/FillmoreCancerData/markhe/VTERisk/Notebooks/PostRun_Analysis/Output')
MD = read.csv('Multi/Dx5_5.csv')
MD = MD[order(MD$patient_id),]
MD$X = MD$patient_id
MD$pids = NULL
MD$patient_id = NULL
MD$dob = NULL
MD$days_from_outcome = (as.Date(MD$outcome_date) - as.Date(MD$date)) %>% as.numeric()
#MD$diag_date = NULL
MD$daysfrom_index = (as.Date(MD$date) - as.Date(MD$index_date)) %>% as.numeric()
MD$y =  ifelse(MD$golds == "True", 1, 0)
MD$p = MD$probs / max(MD$probs)
MD$censor_times = NULL
MD$Diag_to_Index =(MD$index_date%>%as.Date() - MD$diag_date%>%as.Date())%>% as.numeric()
#MD = MD[MD$Diag_to_Index > 29 , ]
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
#pROC::auc( MD$y,  MD$probs )
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
confu (Y1$probs, Y1$y, .07)
pROC::auc( Y2$y,  (Y2$probs) )
confu (Y2$probs, Y2$y)
pROC::auc( Y3$y,  (Y3$probs) )
confu (Y3$probs, Y3$y, .07)
pROC::auc( Y4$y,  (Y4$probs) )
confu (Y4$probs, Y4$y, .07)
MD = MD[MD$Diag_to_Index > 29 , ]
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
confu (Y1$probs, Y1$y, .07)
pROC::auc( Y2$y,  (Y2$probs) )
confu (Y2$probs, Y2$y)
pROC::auc( Y3$y,  (Y3$probs) )
confu (Y3$probs, Y3$y, .07)
pROC::auc( Y4$y,  (Y4$probs) )
confu (Y4$probs, Y4$y, .07)
setwd('G:/FillmoreCancerData/markhe/VTERisk/Notebooks/PostRun_Analysis/Output')
MD = read.csv('Multi/Dx5_5.csv')
MD = MD[order(MD$patient_id),]
MD$X = MD$patient_id
MD$pids = NULL
MD$patient_id = NULL
MD$dob = NULL
MD$days_from_outcome = (as.Date(MD$outcome_date) - as.Date(MD$date)) %>% as.numeric()
#MD$diag_date = NULL
MD$daysfrom_index = (as.Date(MD$date) - as.Date(MD$index_date)) %>% as.numeric()
MD$y =  ifelse(MD$golds == "True", 1, 0)
MD$p = MD$probs / max(MD$probs)
MD$censor_times = NULL
MD$Diag_to_Index =(MD$index_date%>%as.Date() - MD$diag_date%>%as.Date())%>% as.numeric()
MD = MD[MD$Diag_to_Index > 59 , ]
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
#pROC::auc( MD$y,  MD$probs )
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
confu (Y1$probs, Y1$y, .07)
pROC::auc( Y2$y,  (Y2$probs) )
confu (Y2$probs, Y2$y)
pROC::auc( Y3$y,  (Y3$probs) )
confu (Y3$probs, Y3$y, .07)
pROC::auc( Y4$y,  (Y4$probs) )
confu (Y4$probs, Y4$y, .07)
message(normalizePath("~"))
rm(list = ls())
library(fst)
library(dplyr)
library(stringr)
library(plyr)
library(data.table)
library(caret)
library("Metrics")
setwd('G:/FillmoreCancerData/markhe/VTERisk/Notebooks/PostRun_Analysis/Output')
MD = read.csv('Multi/Dx5_5.csv')
MD = MD[order(MD$patient_id),]
MD$X = MD$patient_id
MD$pids = NULL
MD$patient_id = NULL
MD$dob = NULL
MD$days_from_outcome = (as.Date(MD$outcome_date) - as.Date(MD$date)) %>% as.numeric()
#MD$diag_date = NULL
MD$daysfrom_index = (as.Date(MD$date) - as.Date(MD$index_date)) %>% as.numeric()
MD$y =  ifelse(MD$golds == "True", 1, 0)
MD$p = MD$probs / max(MD$probs)
MD$censor_times = NULL
MD$Diag_to_Index =(MD$index_date%>%as.Date() - MD$diag_date%>%as.Date())%>% as.numeric()
MD = MD[MD$Diag_to_Index > 59 , ]
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
confu (Y1$probs, Y1$y, .07)
pROC::auc( Y2$y,  (Y2$probs) )
confu (Y2$probs, Y2$y)
pROC::auc( MD$y,  MD$probs )
pROC::auc( MD$y,  (MD$probs) )
pROC::auc( Y1$y,  (Y1$probs) )
pROC::auc( Y2$y,  (Y2$probs) )
pROC::auc( Y3$y,  (Y3$probs) )
pROC::auc( Y4$y,  (Y4$probs) )
V1 = Y1[Y1$y==1,]
V2= Y2[Y2$y==1,]
V3= Y3[Y3$y==1,]
V4= Y4[Y4$y==1,]
900 + 368 + 208 + 145
796 + 390+194+131
hist(V1$exams)
setwd('G:/FillmoreCancerData/markhe/VTERisk/Notebooks/PostRun_Analysis/Output')
MD = read.csv('Multi/J6DX.csv')
MD = MD[order(MD$patient_id),]
MD$X = MD$patient_id
MD$pids = NULL
MD$patient_id = NULL
MD$dob = NULL
MD$days_from_outcome = (as.Date(MD$outcome_date) - as.Date(MD$date)) %>% as.numeric()
#MD$diag_date = NULL
MD$daysfrom_index = (as.Date(MD$date) - as.Date(MD$index_date)) %>% as.numeric()
MD$y =  ifelse(MD$golds == "True", 1, 0)
MD$p = MD$probs / max(MD$probs)
MD$censor_times = NULL
MD$Diag_to_Index =(MD$index_date%>%as.Date() - MD$diag_date%>%as.Date())%>% as.numeric()
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
pROC::auc( Y2$y,  (Y2$probs) )
pROC::auc( Y3$y,  (Y3$probs) )
pROC::auc( Y4$y,  (Y4$probs) )
confu (Y1$probs, Y1$y, .07)
confu (Y2$probs, Y2$y)
confu (Y3$probs, Y3$y, .07)
confu (Y4$probs, Y4$y, .07)
V1 = Y1[Y1$y==1,]
V2= Y2[Y2$y==1,]
V3= Y3[Y3$y==1,]
V4= Y4[Y4$y==1,]
900 + 368 + 208 + 145
796 + 390+194+131
hist(V1$exams)
cor(V1$exams, V1$probs)
cor(V2$exams, V2$probs)
cor(V3$exams, V3$probs)
cor(V4$exams, V4$probs)
hist(V1$exams[V1$exams<1000])
hist(V2$exams)
hist(V2$exams)
hist(V4$exams)
summary(V1$exams)
summary(V2$exams)
MD = MD[MD$Diag_to_Index > 59 , ]
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
pROC::auc( Y2$y,  (Y2$probs) )
pROC::auc( Y3$y,  (Y3$probs) )
pROC::auc( Y4$y,  (Y4$probs) )
hist(Y1$exams)
hist(Y2$exams)
hist(Y2$exams)
hist(V4$exams)
hist(Y1$exams)
hist(Y2$exams)
hist(Y3$exams)
hist(Y4$exams)
message(normalizePath("~"))
rm(list = ls())
library(fst)
library(dplyr)
library(stringr)
library(plyr)
library(data.table)
library(caret)
library("Metrics")
setwd('G:/FillmoreCancerData/markhe/VTERisk/Notebooks/PostRun_Analysis/Output')
MD = read.csv('Multi/Dx5_3_Again.csv')
MD = MD[order(MD$patient_id),]
MD$X = MD$patient_id
MD$pids = NULL
MD$patient_id = NULL
MD$dob = NULL
MD$days_from_outcome = (as.Date(MD$outcome_date) - as.Date(MD$date)) %>% as.numeric()
#MD$diag_date = NULL
MD$daysfrom_index = (as.Date(MD$date) - as.Date(MD$index_date)) %>% as.numeric()
MD$y =  ifelse(MD$golds == "True", 1, 0)
MD$p = MD$probs / max(MD$probs)
MD$censor_times = NULL
#MD$Diag_to_Index =(MD$index_date%>%as.Date() - MD$diag_date%>%as.Date())%>% as.numeric()
#MD = MD[MD$Diag_to_Index > 13 , ]
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
#pROC::auc( MD$y,  MD$probs )
table( Y1$y)
pROC::auc( Y1$y,  (Y1$probs) )
p1 = Y1$probs / max(Y1$probs) # scaled??
p2 = Y2$probs / max(Y2$probs) # scaled??
p3 = Y3$probs / max(Y3$probs) # scaled??
p4 = Y4$probs / max(Y4$probs) # scaled??
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
confu (p1, Y1$y)
confu (Y1$probs, Y1$y)
#YD.1 = Y1[Y1$Diag_to_Index > 69 , ]
#pROC::auc( YD.1$y,  (YD.1$probs) )
pROC::auc( Y2$y,  (Y2$probs) )
confu (p2, Y2$y)
confu (Y2$probs, Y2$y)
YD.2 = Y2[Y2$Diag_to_Index > 69 , ]
pROC::auc( YD.2$y,  (YD.2$probs) )
setwd('G:/FillmoreCancerData/markhe/VTERisk/Notebooks/PostRun_Analysis/Output')
MD = read.csv('Multi/Dx5_3_Again.csv')
MD = MD[order(MD$patient_id),]
MD$X = MD$patient_id
MD$pids = NULL
MD$patient_id = NULL
MD$dob = NULL
MD$days_from_outcome = (as.Date(MD$outcome_date) - as.Date(MD$date)) %>% as.numeric()
#MD$diag_date = NULL
MD$daysfrom_index = (as.Date(MD$date) - as.Date(MD$index_date)) %>% as.numeric()
MD$y =  ifelse(MD$golds == "True", 1, 0)
MD$p = MD$probs / max(MD$probs)
MD$censor_times = NULL
MD$Diag_to_Index =(MD$index_date%>%as.Date() - MD$diag_date%>%as.Date())%>% as.numeric()
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
table( Y1$y)
pROC::auc( Y1$y,  (Y1$probs) )
p1 = Y1$probs / max(Y1$probs) # scaled??
p2 = Y2$probs / max(Y2$probs) # scaled??
p3 = Y3$probs / max(Y3$probs) # scaled??
p4 = Y4$probs / max(Y4$probs) # scaled??
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
confu (p1, Y1$y)
confu (Y1$probs, Y1$y)
pROC::auc( Y2$y,  (Y2$probs) )
confu (p2, Y2$y)
confu (Y2$probs, Y2$y)
YD.2 = Y2[Y2$Diag_to_Index > 69 , ]
pROC::auc( YD.2$y,  (YD.2$probs) )
pROC::auc( Y3$y,  (Y3$probs) )
confu (p3, Y3$y)
confu (p3, Y3$y, .25)
pROC::auc( Y4$y,  (Y4$probs) )
confu (Y4$probs, Y4$y)
confu (p4, Y4$y, .3)
confu (Y4$probs + max(Y4$probs), Y4$y)
hist(Y4$probs)
pos_analysis = function(){
V1 = Y1[Y1$y==1,]
V2= Y2[Y2$y==1,]
V3= Y3[Y3$y==1,]
V4= Y4[Y4$y==1,]
900 + 368 + 208 + 145
796 + 390+194+131
hist(V1$exams)
cor(V1$exams, V1$probs)
cor(V2$exams, V2$probs)
cor(V3$exams, V3$probs)
cor(V4$exams, V4$probs)
hist(V1$exams[V1$exams<1000])
hist(V2$exams)
hist(V2$exams)
hist(V4$exams)
summary(V1$exams)
summary(V2$exams)
}
MD = MD[MD$Diag_to_Index > 59 , ]
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
pROC::auc( Y2$y,  (Y2$probs) )
pROC::auc( Y3$y,  (Y3$probs) )
pROC::auc( Y4$y,  (Y4$probs) )
setwd('G:/FillmoreCancerData/markhe/VTERisk/Notebooks/PostRun_Analysis/Output')
MD = read.csv('Multi/Dx5_3_Again.csv')
MD = MD[order(MD$patient_id),]
MD$X = MD$patient_id
MD$pids = NULL
MD$patient_id = NULL
MD$dob = NULL
MD$days_from_outcome = (as.Date(MD$outcome_date) - as.Date(MD$date)) %>% as.numeric()
#MD$diag_date = NULL
MD$daysfrom_index = (as.Date(MD$date) - as.Date(MD$index_date)) %>% as.numeric()
MD$y =  ifelse(MD$golds == "True", 1, 0)
MD$p = MD$probs / max(MD$probs)
MD$censor_times = NULL
MD$Diag_to_Index =(MD$index_date%>%as.Date() - MD$diag_date%>%as.Date())%>% as.numeric()
#MD = MD[MD$Diag_to_Index > 13 , ]
MD = MD[MD$Diag_to_Index > 13 , ]
firsts = !duplicated(MD$X)
Y1 = MD[firsts,]
Y_not1 = MD[!firsts,]
seconds = !duplicated(Y_not1$X)
Y2 = Y_not1[seconds,]
Y_not2 = Y_not1[!seconds,]
thirds = !duplicated(Y_not2$X)
Y3 = Y_not2[thirds,]
Y_not3 = Y_not2[!thirds,]
fourths = !duplicated(Y_not3$X)
Y4 = Y_not3[fourths,]
confu = function(p, yy, THRESH=.5){
CM = confusionMatrix( ifelse(p > THRESH,1,0) %>% as.factor(), yy %>% as.factor())
t(CM$table)
}
pROC::auc( MD$y,  MD$probs )
#pROC::auc( MD$y,  MD$probs )
pROC::auc( MD$y,  (MD$probs) )
confu (  (MD$probs) , MD$y)
pROC::auc( Y1$y,  (Y1$probs) )
pROC::auc( Y2$y,  (Y2$probs) )
pROC::auc( Y3$y,  (Y3$probs) )
pROC::auc( Y4$y,  (Y4$probs) )
pROC::auc( Y1$y,  (Y1$probs) )
pROC::auc( Y2$y,  (Y2$probs) )
pROC::auc( Y3$y,  (Y3$probs) )
pROC::auc( Y4$y,  (Y4$probs) )
hist(Y1$exams)
hist(Y2$exams)
hist(Y3$exams)
hist(Y4$exams)
hist(V1$exams)
V1 = Y1[Y1$y==1,]
V2= Y2[Y2$y==1,]
V3= Y3[Y3$y==1,]
V4= Y4[Y4$y==1,]
hist(V1$exams)
hist(V2$exams)
hist(V3$exams)
hist(V4$exams)
hist(Y1$exams)
hist(Y1$exams, breaks = 10)
hist(Y1$exams, breaks = 20)
hist(Y1$exams, breaks = 50)
